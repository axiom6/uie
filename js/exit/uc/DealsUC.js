// Generated by CoffeeScript 1.10.0
(function() {
  var $, DealsUC;

  $ = require('jquery');

  DealsUC = (function() {
    module.exports = DealsUC;

    function DealsUC(stream, role, port, land) {
      this.stream = stream;
      this.role = role;
      this.port = port;
      this.land = land;
      this.etaHoursMins = '?';
      this.uom = 'em';
    }

    DealsUC.prototype.ready = function() {
      return this.$ = $(this.html());
    };

    DealsUC.prototype.position = function(screen) {
      this.onScreen(screen);
      return this.subscribe();
    };

    DealsUC.prototype.html = function() {
      return "<div id=\"" + (Util.htmlId('DealsUC', this.role)) + "\" class=\"" + (Util.css('DealsUC')) + "\"></div>";
    };

    DealsUC.prototype.subscribe = function() {
      this.stream.subscribe('Trip', (function(_this) {
        return function(trip) {
          return _this.onTrip(trip);
        };
      })(this));
      this.stream.subscribe('Location', (function(_this) {
        return function(location) {
          return _this.onLocation(location);
        };
      })(this));
      this.stream.subscribe('Screen', (function(_this) {
        return function(screen) {
          return _this.onScreen(screen);
        };
      })(this));
      return this.stream.subscribe('Deals', (function(_this) {
        return function(deals) {
          return _this.onDeals(deals);
        };
      })(this));
    };

    DealsUC.prototype.onTrip = function(trip) {
      this.etaHoursMins = trip.etaHoursMins();
      return this.onDeals(trip.deals);
    };

    DealsUC.prototype.onLocation = function(location) {
      return Util.noop('DealsUC.onLocation()', this.ext, location);
    };

    DealsUC.prototype.onScreen = function(screen) {
      return Util.cssPosition(this.$, screen, this.port, this.land);
    };

    DealsUC.prototype.onConditions = function(conditions) {
      return Util.noop('Deals.onConditions()', conditions);
    };

    DealsUC.prototype.onDeals = function(deals) {
      var deal, html, i, len, results;
      html = this.dealsHtml("Exit Now", 'Traffic Slow', this.etaHoursMins, deals);
      this.$.append(html);
      results = [];
      for (i = 0, len = deals.length; i < len; i++) {
        deal = deals[i];
        results.push(this.enableTakeDealClick(deal._id));
      }
      return results;
    };

    DealsUC.prototype.dealsHtml = function(title, traffic, eta, deals) {
      var deal, html, i, len;
      this.uom = 'em';
      html = '';
      html += this.dealsTitle(title, 1.00);
      html += this.dealsTrafficEta(traffic, eta, 0.75);
      for (i = 0, len = deals.length; i < len; i++) {
        deal = deals[i];
        html += this.dealHtml(deal, 0.80, true);
      }
      html += "</div>";
      return html;
    };

    DealsUC.prototype.dealsTitle = function(title, fontSize) {
      return "<div style=\"text-align:center;\">\n<div style=\"font-size:" + (this.fs(fontSize)) + ";\">" + title + "</div>";
    };

    DealsUC.prototype.dealsTrafficEta = function(traffic, eta, fontSize) {
      return "<div style=\"font-size:" + (this.fs(fontSize)) + ";\"><span>" + traffic + "</span><span style=\"font-weight:bold;\"> " + eta + "</span></div>";
    };

    DealsUC.prototype.dealHtml = function(deal, fontSize, take) {
      var html, padding, takeSize;
      padding = 0.2 * fontSize;
      takeSize = 1.0 * fontSize;
      html = "<hr  style=\"margin:" + (this.fs(padding)) + "\"</hr>";
      html += "<div style=\"font-size:" + (this.fs(fontSize)) + ";\">" + deal.dealData.name + "</div>\n<div style=\"font-size:" + (this.fs(fontSize)) + ";\"><span>" + deal.dealData.businessName + "</span>" + (this.takeDeal(deal._id, takeSize, padding, take)) + "</div>";
      return html;
    };

    DealsUC.prototype.fs = function(size) {
      return size + this.uom;
    };

    DealsUC.prototype.takeDeal = function(dealId, fontSize, padding, take) {
      var style;
      if (take) {
        style = "font-size:" + (this.fs(fontSize)) + "; margin-left:" + (this.fs(fontSize)) + "; padding:" + (this.fs(padding)) + "; border-radius:" + (this.fs(padding * 2)) + "; background-color:#E2492F; color:white;";
        return "<span dataid=\"" + dealId + "\" style=\"" + style + "\">Take Deal</span>";
      } else {
        return '';
      }
    };

    DealsUC.prototype.enableTakeDealClick = function(dealId) {
      return this.$.find("[dataid=" + dealId + "]").click((function(_this) {
        return function() {
          Util.dbg('Deal.TakeDeal', dealId);
          return _this.stream.publish('TakeDeal', dealId);
        };
      })(this));
    };

    DealsUC.prototype.iAmExiting = function(dataId) {
      return "<div style=\"margin-top:0.5em;\"><span dataid=\"" + dataId + "\" style=\"font-size:0.9em; padding:0.3em; background-color:#658552; color:white;\">I'M EXITING</span></div></div>";
    };

    return DealsUC;

  })();

}).call(this);
